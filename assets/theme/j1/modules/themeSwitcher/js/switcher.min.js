/*
 # -----------------------------------------------------------------------------
 # ~/assets/theme/j1/modules/bsThemeSwitcher/js/switcher.js
 # Provides Javascript functions for Bootstrap ThemeSwitcher
 #
 # Product/Info:
 # https://jekyll.one
 # https://github.com/jguadagno/bootstrapThemeSwitcher
 #
 # Copyright (C) 2023-2025 Juergen Adams
 # Copyright (C) 2014 Joseph Guadagno
 #
 # J1 Template is licensed under the MIT License.
 # See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # Bootstrap Theme Switcher is licensed under the MIT License.
 # See: https://github.com/jguadagno/bootstrapThemeSwitcher
 # -----------------------------------------------------------------------------
 # NOTE: This modules is MODIFIED to be used with MobileMenu (mmenuLight).
 #       The original version cannot be used with J1 for theme menu creation!
 # -----------------------------------------------------------------------------
*/

!function(e,t,o,s){"use strict";var i,n,a=j1.getCookieNames(),h=j1.findCookie("_ga"),r=j1.findCookie("j1"),c=new liteURL(t.location.href),l=c.hostname,m=(l.substring(l.lastIndexOf(".",l.lastIndexOf(".")-1)+1),!!c.protocol.includes("https")),d=log4javascript.getLogger("j1.themes.switcher"),u={},f=function(t,o){return this.$element=e(t),this.settings=e.extend({},e.fn.ThemeSwitcher.defaults,o),this.themesList=[],this.getThemes(),this};f.prototype={clear:function(){return d.debug("ThemeSwitcher.clear"),this.$element.each((function(){this.$element.empty()}))},update:function(){d.debug("ThemeSwitcher.update"),this.getThemes()},checkStyleSheetByName:function(e){for(var t=!1,s=new RegExp("/"+e+"/","i"),i=0;i<o.styleSheets.length;i++)if(s.test(o.styleSheets[i].href)){t=!0;break}return t},switchTheme:function(t,o){var s=e(this),n=e.extend({},e.fn.ThemeSwitcher.defaults,s.data("ThemeSwitcher")),c=(n.cssThemeLink,n.debug);this.settings.includeBootswatch;if(j1.existsCookie(a.user_state)?(d.info("cookie found: "+a.user_state),i=j1.readCookie(a.user_state)):(d.error("cookie not found: "+a.user_state),d.info("j1 cookies found:"+r.length),r.forEach((function(e){console.log("j1.themes.switcher: "+e)})),d.info("ga cookies found:"+h.length),h.forEach((function(e){console.log("j1.themes.switcher: "+e)}))),i.theme_name,i.theme_css,void 0===o&&(o=this.settings.defaultCssFile),void 0===t&&(t=o),n.saveToCookie){if("undefined"==typeof Cookies)return"true"===c&&d.error("cookies library not present"),!1;i.theme_name=t,i.theme_css=o,i.theme_name.includes("Uno")||"Bootstrap"==i.theme_name?(i.theme_author="J1 Team",i.theme_author_url="https://jekyll.one/"):(i.theme_author="Bootswatch",i.theme_author_url="https://bootswatch.com/"),d.info("write to cookie : "+a.user_state),j1.writeCookie({name:a.user_state,data:i,secure:m,expires:365}),location.reload(!0)}else d.info("write to cookie : disabled"),d.warn("selected theme not activated: "+t)},loadThemeFromCookie:function(t){if("undefined"==typeof Cookies)return d.error("cookies library not present"),!1;e.extend({},e.fn.ThemeSwitcher.defaults,t);j1.existsCookie(a.user_state)?(d.info("cookie found: "+a.user_state),i=j1.readCookie(a.user_state)):(d.error("cookie not found: "+a.user_state),d.info("j1 cookies found:"+r.length),r.forEach((function(e){console.log("j1.themes.switcher: "+e)})),d.info("ga cookies found:"+h.length),h.forEach((function(e){console.log("j1.themes.switcher: "+e)})));var o=i.theme_name,s=i.theme_css;this.switchTheme(o,s)},addTheme:function(e,t,o,s){void 0===o&&(o=0),void 0===s&&(s=0),this.themesList.splice(o,s,{name:e,css:t}),this.addThemesToControl()},addThemesToControl:function(){if(void 0===this.$element)return d.error("bootstrapThemeSelector|addThemesToControl: Element is undefined"),!1;if(void 0===this.themesList)return d.error("bootstrapThemeSelector|addThemesToControl: Themes is undefined"),!1;if(this.settings.excludeBootswatch){var t;-1!==this.settings.excludeBootswatch.indexOf(",")?t=this.settings.excludeBootswatch.replace(/ /g,"").split(","):(t=[]).push(this.settings.excludeBootswatch);var o=this.themesList;e.each(o,(function(s,i){i&&i.name&&-1!==e.inArray(i.name,t)&&o.splice(s,1)})),this.themesList=o}var s=this;if(this.$element.is("ul")){var c,l=e(this),m=e.extend({},e.fn.ThemeSwitcher.defaults,l.data("ThemeSwitcher")),f=(m.cssThemeLink,m.debug);j1.existsCookie(a.user_state)?(d.info("user state cookie found"),i=j1.readCookie(a.user_state)):(d.error("user state NOT cookie found"),d.info("j1 cookies found:"+r.length),r.forEach((function(e){console.log("j1.themes.switcher: "+e)})),d.info("ga cookies found:"+h.length),h.forEach((function(e){console.log("j1.themes.switcher: "+e)}))),c=i.theme_name,"true"===f&&d.info("bootstrapThemeSelector: UL element selected"),this.$element.empty();var p="";e.each(this.themesList,(function(t,o){p=s.$element[0].id.includes("mmenu")?"mmenu-item":"dropdown-item",o.name===c&&(p=s.$element[0].id.includes("mmenu")?"mmenu-item active":"dropdown-item active");var i=e("<li />").attr("class",p).append('<a class="link-no-decoration" href="#"><i class="mdib mdib-view-quilt mdib-18px mr-2" style="color: #9E9E9E"></i>'+o.name+"</a>").on("click",(function(){m.loadFromBootswatch?s.switchTheme(o.name,o.css):s.switchTheme(o.name,o.cssCdn),e(this).parent().find("li").removeClass("active"),e(this).addClass("active")}));s.$element.append(i)})),n=s.$element[0].className.includes("dropdown-menu")?"desktop":"mobile",u.type="state",u.action="menu loaded for : "+n,u.text="menu loaded on id: "+s.$element[0].id,j1.sendMessage("ThemeSwitcher","j1.adapter.navigator",u)}else if(this.$element.is("select")){var T;d.info("bootstrapThemeSelector: SELECT element selected"),this.$element.empty(),e.each(this.themesList,(function(e,t){T=null,t.name===c&&(T="selected"),m.loadFromBootswatch?s.$element.append("<option "+T+" value='"+t.css+"'>"+t.name+"</option>"):s.$element.append("<option "+T+" value='"+t.cssCdn+"'>"+t.name+"</option>")})),this.$element.on("change",(function(){var t=e("option:selected",this);s.switchTheme(t.text(),t.val())}))}else d.info("bootstrapThemeSelector: no UL or SELECT element found"),d.error("bootstrapThemeSelector: failed")},getThemes:function(){var t=this;null!==this.settings.localFeed&&""!==this.settings.localFeed?e.ajax({url:this.settings.localFeed,dataType:"json",success:function(e){t.themesList=e.themes,t.addThemesToControl()},error:function(e,o,s){d.error("failed to retrieve the local feed from: '"+t.settings.localFeed+"'")}}):e.ajax({url:this.settings.bootswatchApiUrl+"/"+this.settings.bootswatchApiVersion+".json",dataType:"json",success:function(e){if(void 0===e.themes)return null;t.themesList=e.themes,t.themesList.splice(0,0,{name:"default",css:t.settings.defaultCssFile}),t.addThemesToControl()}})},themes:function(e){if(void 0===e)return this.themesList;this.themesList=e}},e.fn.ThemeSwitcher=function(t){var o,s=Array.prototype.slice.call(arguments,1),i=e(this),n=i.data("ThemeSwitcher"),a="object"==typeof t&&t;return n||i.data("ThemeSwitcher",n=new f(this,a)),"string"==typeof t&&(o=n[t].apply(n,s)),void 0===o?i:o},e.fn.ThemeSwitcher.defaults={debug:!1,saveToCookie:!0,cssThemeLink:"bootstrapTheme",cookieThemeName:"bootstrapTheme.name",cookieThemeCss:"boostrapTheme.css",cookieExpiration:365,cookiePath:"/",defaultCssFile:"https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css",bootswatchApiUrl:"https://bootswatch.com/api/",bootswatchApiVersion:"5",loadFromBootswatch:!0,localFeed:"",excludeBootswatch:""},e.fn.ThemeSwitcher.Constructor=f}(jQuery,window,document);
