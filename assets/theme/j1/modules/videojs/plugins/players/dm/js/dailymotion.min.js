/*
 # -----------------------------------------------------------------------------
 # ~/assets/theme/j1/modules/videojs/js/plugins/players/dm/dailymotion.min.js
 # Provides Dailymotion Playback Technology (Tech) for Video.js V8 and newer
 #
 #  Product/Info:
 #  http://jekyll.one
 #
  # Copyright (C) John Law
 #  Copyright (C) 2023-2025 Juergen Adams
 #
 #  J1 Theme is licensed under MIT License.
 #  See: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # -----------------------------------------------------------------------------
*/

/* Dailymotion Javascript SDK (J1 Version) - v2022-10-18 */

!function(e,t){if("object"==typeof exports&&"undefined"!=typeof module){var i=require("video.js");module.exports=t(i.default||i)}else"function"==typeof define&&define.amd?define(["videojs"],(function(i){return e.Dailymotion=t(i)})):e.Dailymotion=t(e.videojs)}(this,(function(e){"use strict";const t="development"===j1.env||"dev"===j1.env;var i,r,s=log4javascript.getLogger("videoJS.plugin.dailymotion"),a=e.browser.IS_IOS||e.browser.IS_ANDROID,d=e.getTech("Tech");class l extends d{constructor(e,t){super(e,t),this.setPoster(e.poster),this.setSrc(this.options_.source,!0);var i=this;setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-dailymotion",a&&(this.el_.parentNode.className+=" vjs-dailymotion-mobile"),l.isSdkReady?i.initDMPlayer():l.sdkReadyQueue.push(i))}.bind(this))}getPlayerParams(){var e={autoplay:!1,mute:!1,controls:!1,"queue-autoplay-next":!1,"queue-enable":!1},t=this.options_;if(["api","autoplay","autoplay-mute","id","mute","origin","quality","queue-autoplay-next","queue-enable","sharing-enable","start","subtitles-default","syndication","ui-highlight","ui-logo","ui-start-screen-info","ui-theme","apimode","playlist"].forEach((i=>{void 0!==t[i]&&(e[i]=t[i])})),void 0!==this.options_.dmControls&&(e.controls=this.options_.dmControls),this.url&&void 0!==this.url.playlist&&(e.playlist=this.url.playlist),void 0!==this.options_.customVars){var i=this.options_.customVars;Object.keys(i).forEach((t=>{e[t]=i[t]}))}return e}getPlayerConfig(){var e={width:"100%",height:"100%",params:this.getPlayerParams()};return this.url&&void 0!==this.url.video?e.video=this.url.video:void 0!==this.options_.video&&(e.video=this.options_.video),e}initDMPlayer(){if(this.dmPlayer)this.dmPlayer.dmPlayerState={ended:!1,playing:!1,muted:!1,volume:0,progress:{seconds:0,percent:0,duration:0}};else{this.dmPlayer=new DM.player(document.getElementById(this.options_.techId),this.getPlayerConfig());var e=this;this.isApiReady=!1,this.dmPlayer.addEventListener("apiready",(()=>{e.triggerReady(),e.isApiReady=!0})),this.dmPlayer.addEventListener("durationchange",(()=>{e.trigger("durationchange")})),this.dmPlayer.addEventListener("end",(()=>{e.trigger("ended")})),this.dmPlayer.addEventListener("error",(()=>{e.trigger("error")})),this.dmPlayer.addEventListener("loadedmetadata",(()=>{e.trigger("loadeddata"),e.trigger("loadedmetadata")})),this.dmPlayer.addEventListener("pause",(()=>{e.trigger("pause")})),this.dmPlayer.addEventListener("play",(()=>{e.trigger("loadStart"),e.trigger("play"),e.trigger("playing"),e.trigger("waiting")})),this.dmPlayer.addEventListener("playback_ready",(()=>{e.trigger("loadeddata")})),this.dmPlayer.addEventListener("timeupdate",(()=>{e.trigger("timeupdate")})),this.dmPlayer.addEventListener("volumechange",(()=>{e.trigger("volumechange")})),this.triggerReady(),t&&s.debug("\ncreated "+this.name_+" player on ID: "+e.dmPlayer.id)}}autoplay(e){return void 0!==e?this.setAutoplay(e):this.options_.autoplay}setAutoplay(e){return this.options_.autoplay=e}buffered(){return this.dmPlayer&&this.dmPlayer.bufferedTime?e.time.createTimeRanges(0,this.dmPlayer.bufferedTime):e.time.createTimeRanges()}createEl(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","cursor: default; width:100%; height:100%; top:0; left:0; position:absolute"),e.setAttribute("class","vjs-tech");var t=document.createElement("div");return t.appendChild(e),t}currentSrc(){return this.source&&this.source.src}currentTime(e){return void 0!==e?this.setCurrentTime(e):this.dmPlayer&&this.dmPlayer.currentTime}setCurrentTime(e){if(this.dmPlayer&&this.dmPlayer.seek)return this.dmPlayer.seek(e)}dispose(){if(DM&&DM.destroy)DM.destroy(this.options_.techId);else{var e=l.sdkReadyQueue.indexOf(this);-1!==e&&l.sdkReadyQueue.splice(e,1)}this.dmPlayer=void 0,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-dailymotion","").replace(" vjs-dailymotion-mobile",""),this.el_.parentNode.removeChild(this.el_),d.prototype.dispose.call(this)}duration(e){return void 0!==e?this.setDuration(e):this.dmPlayer?this.dmPlayer.duration:0}setDuration(e){if(this.dmPlayer&&this.dmPlayer.seek)return this.dmPlayer.seek(e)}ended(){return this.dmPlayer&&this.dmPlayer.ended}enterFullWindow(){if(this.dmPlayer&&this.dmPlayer.setFullscreen)return this.dmPlayer.setFullscreen(!0)}error(){return this.dmPlayer&&this.dmPlayer.error}exitFullscreen(){if(this.dmPlayer&&this.dmPlayer.setFullscreen)return this.dmPlayer.setFullscreen(!1)}isFullscreen(){return this.dmPlayer&&this.dmPlayer.fullscreen}language(){}languages(){}load(){if(this.dmPlayer&&this.dmPlayer.load)return this.dmPlayer.load(this.getPlayerConfig())}loop(){}muted(e){return void 0!==typeof e?this.setMuted(e):this.dmPlayer&&this.dmPlayer.mute}setMuted(e){void 0!==e&&this.dmPlayer&&this.dmPlayer.setMuted&&(e?(this.volumeBeforeMute=this.volume(),this.setVolume(0)):this.setVolume(this.volumeBeforeMute),this.dmPlayer.setMuted(e))}networkState(){return!this.dmPlayer||this.dmPlayer.error?0:this.dmPlayer.seeking?2:void 0}pause(){if(this.dmPlayer&&this.dmPlayer.pause)return this.dmPlayer.pause()}paused(){return this.dmPlayer&&this.dmPlayer.paused}play(){if(this.isApiReady&&this.dmPlayer&&this.dmPlayer.play)return this.trigger("loadStart"),this.trigger("waiting"),this.dmPlayer.play()}playbackRate(){return 1}poster(){}preload(){}readyState(){return!this.dmPlayer||this.dmPlayer.error?0:this.dmPlayer.seeking?1:4}remainingTime(){return this.dmPlayer&&this.dmPlayer.duration-this.dmPlayer.currentTime}requestFullscreen(){return this.enterFullWindow()}enterFullScreen(){return this.enterFullWindow()}reset(){this.load()}seekable(){return this.ytPlayer?e.time.createTimeRanges(0,this.ytPlayer.getDuration()):e.time.createTimeRanges()}seeking(){return this.dmPlayer&&this.dmPlayer.seeking}src(e){return void 0!==e?this.setSrc(e):this.source}setSrc(e){if(void 0!==e)return this.source=e,this.url=l.parseUrl(e.src||e),l.isSdkReady&&this.load(),this.source}supportsFullScreen(){return!0}volume(){return this.dmPlayer?this.dmPlayer.volume:1}setVolume(e){this.dmPlayer&&this.dmPlayer.setMuted&&this.dmPlayer.setVolume&&this.dmPlayer.apiReady&&(this.dmPlayer.setMuted(!1),this.dmPlayer.setVolume(e))}}function n(){t&&s.debug("\nAPI loaded successfully"),l.isSdkReady=!0;for(var e=0;e<l.sdkReadyQueue.length;++e)l.sdkReadyQueue[e].initDMPlayer();t&&s.debug("\ncreated all players from queue: #"+e),r=Date.now(),t&&s.debug("\ninitializing plugin: finished"),t&&s.debug("\nplugin initializing time: "+(r-i)+"ms")}l.isSupported=()=>!0,l.canPlaySource=e=>l.canPlayType(e.type),l.canPlayType=e=>"video/dailymotion"===e,l.parseUrl=e=>{var t={},i=e.match(/video\/[^?|^\/]*/);i&&i[0]&&(t.video=i[0].replace("video/",""));return(i=e.match(/playlist(=|\/)[^&]*/))&&i[0]&&(t.playlist=i[0].replace(/playlist(=|\/)/,"")),t},l.VERSION="1.0.0",l.sdkReadyQueue=[];var o=setInterval((()=>{var r="block"===$("#content").css("display");"finished"===j1.getState()&&r&&(i=Date.now(),t&&s.debug("\ninitializing plugin: started"),t&&s.debug("\nversion of videoJS detected: "+e.VERSION),function(e,t){var i=!1,r=document.createElement("script"),s=document.getElementsByTagName("script")[0];s&&(s.parentNode.insertBefore(r,s),r.onload=()=>{i||(i=!0,t())},r.onreadystatechange=()=>{i||"complete"!==this.readyState&&"loaded"!==this.readyState||(i=!0,t())},r.src=e)}("//api.dmcdn.net/all.js",n),function(){const e="\n      .vjs-dailymotion .vjs-iframe-blocker { display: none; }\n      .vjs-dailymotion.vjs-user-inactive .vjs-iframe-blocker { display: block; }\n      .vjs-dailymotion .vjs-poster { background-size: cover; }\n      .vjs-dailymotion-mobile .vjs-big-play-button { display: none; }\n    ";var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.setAttribute("type","text/css"),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),i.appendChild(r),t&&s.debug("\nadded additional CSS styles")}(),clearInterval(o))}),10);void 0!==e.registerTech?e.registerTech("Dailymotion",l):e.registerComponent("Dailymotion",l)}));
