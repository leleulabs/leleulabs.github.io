/*
 # -----------------------------------------------------------------------------
 # ~/assets/theme/j1/modules//js/scroller.min.js
 # J1 core module for scroller
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023-2025 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # For details, see: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # -----------------------------------------------------------------------------
*/

!function(e,t,i,n){"use strict";const s="development"!==j1.env&&"dev"!==j1.env;var o="scroller",r={type:"infiniteScroll",scrollOffset:100,elementScroll:!1,firstPage:2,lastPage:!1,infoLastPage:!1,loadStatus:!1,onInit:function(){},onBeforeLoad:function(){},onAfterLoad:function(){}};function l(t,i){this.element=t,this.settings=e.extend({},r,i),this.settings.elementID="#"+this.element.id,this.init(this.settings)}e.extend(l.prototype,{init:function(i){var n=log4javascript.getLogger("j1.scroller.core"),o=this;s&&n.debug("initializing plugin: started"),s&&n.debug("state: started"),i.elementScroll?o.scroller=o.element:o.scroller=t;var r=setInterval((function(){var t="block"===e("#content").css("display");"finished"===j1.getState()&&t&&("infiniteScroll"===i.type&&(s&&n.debug("processing mode: "+i.type),s&&n.debug("loading items from path: "+i.pagePath),s&&n.debug("monitoring element set to: "+o.scroller),o.registerScrollEvent(i)),"showOnScroll"===i.type&&(s&&n.debug("processing mode: "+i.type),s&&n.debug("loading items from path: "+i.pagePath),s&&n.debug("monitoring element set to: "+o.scroller),o.registerScrollEvent(i)),s&&n.debug("initializing plugin: finished"),s&&n.debug("state: finished"),clearInterval(r))}),25)},isInViewport:function(e,i){if(0!=e.length){var n=jQuery(t),s=n.scrollTop(),o=n.height(),r=s+o,l=jQuery(e),a=l.offset().top+i,d=l.height(),g=a+d;return a>=s&&a<r||g>s&&g<=r||d>o&&a<=s&&g>=r}},isBottomReached:function(n){var s,o=e(n.elementID).height();if(this.settings.elementScroll){var r=e(t),l=r.scrollTop(),a=r.height(),d=l+a-n.scrollOffset,g=e(n.elementID),c=g.offset().top+o,u=g.height();return s=c+u,c>=l&&c<d||s>l&&s<=d||u>a&&c<=l&&s>=d}return t.innerHeight+t.pageYOffset+n.scrollOffset>=i.body.offsetHeight},registerScrollEvent:function(i){var n=log4javascript.getLogger("j1.scroller.core"),o=this;"infiniteScroll"===i.type&&(o[i.id]=function(e){var i=o.settings;if(o.isBottomReached(i)){if(i.firstPage>i.lastPage)return t.removeEventListener("scroll",o[i.id]),s&&n.debug("scroll event removed: "+i.type),i.infoLastPage&&(s&&n.debug("show last page info"),o.infoLastPage(i)),!1;o.getNewPost(i)}},t.addEventListener("scroll",o[i.id]),s&&n.debug("scroll event registered: "+i.type)),"showOnScroll"===i.type&&(o[i.id]=function(r){o.isInViewport(e("#"+i.id),i.scrollOffset)&&(s&&n.debug("specified container is in view: "+i.id),e("."+i.id).show(i.showDelay),t.removeEventListener("scroll",o[i.id]),s&&n.debug("scroll event showOnScroll: removed"))},t.addEventListener("scroll",o[i.id]),s&&n.debug("scroll event registered: "+i.type))},getNewPost:function(t){var i=log4javascript.getLogger("j1.scroller.core"),n=this;if(s&&i.debug("loading new posts"),!1===this.itemsLoaded)return!1;this.itemsLoaded=!1,t.loadStatus&&(s&&i.debug("show: spinner"),e(".loader-ellips").show());var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState==XMLHttpRequest.DONE)if(200==o.status){t.firstPage++;var r=n.getChildItemsByAjaxHTML(t,o.responseText);n.appendNewItems(r),s&&i.debug("loading new items: successful"),t.loadStatus&&(s&&i.debug("hide: spinner"),e(".loader-ellips").hide()),n.itemsLoaded=!0}else t.loadStatus&&(s&&i.debug("hide: spinner"),e(".loader-ellips").hide()),s&&i.error("loading new items failed, HTTP response: "+o.status),n.itemsLoaded=!1},s&&i.debug("loading new items from path: "+t.pagePath+t.firstPage),o.open("GET",location.origin+t.pagePath+t.firstPage+"/index.html",!0),o.send()},getChildItemsByAjaxHTML:function(e,t){var n=log4javascript.getLogger("j1.scroller.core"),o=i.createElement("html");return s&&n.debug("load new items"),o.innerHTML=t,o.querySelectorAll(e.elementID+" > *")},appendNewItems:function(e){var t=log4javascript.getLogger("j1.scroller.core"),n=this,o=j1.getCookieNames(),r=j1.readCookie(o.user_translate);e.forEach((function(e){var o=n.element.id;i.getElementById(o).appendChild(e),s&&t.debug("new item appended")})),r.translationEnabled?(s&&t.debug("translation enabled: "+r.translationEnabled),s&&t.debug("skipped processing of dropcaps")):(s&&t.debug("post processing: createDropCap"),j1.api.createDropCap())},infoLastPage:function(t){var i=t.lastPageInfo;e(i).insertAfter(t.elementID),e(".page-scroll-last").show()}}),e.fn[o]=function(t){return this.each((function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new l(this,t))}))}}(jQuery,window,document);
