/*
 # -----------------------------------------------------------------------------
 # ~/assets/theme/j1/adapter/js/speak2me.js
 # J1 Adapter for the speak2me module
 #
 # Product/Info:
 # https://jekyll.one
 #
 # Copyright (C) 2023-2025 Juergen Adams
 #
 # J1 Template is licensed under the MIT License.
 # For details, see: https://github.com/jekyll-one-org/j1-template/blob/main/LICENSE
 # -----------------------------------------------------------------------------
 # NOTE: Wave styles defind in /assets/data/panel.html, key 'wave'
 # -----------------------------------------------------------------------------
 #  Adapter generated: 2025-09-27 03:33:52 +0200
 # -----------------------------------------------------------------------------
*/
"use strict";j1.adapter.speak2me=((e,t)=>{"development"===e.env||e.env;var a,s,o,i,n,r,d,l,m,u,p,c=e.getCookieNames(),b=(e.readCookie(c.user_state),/Firefox/i.test(navigator.userAgent)),_=/chrome/i.test(navigator.userAgent),k=/Edg/i.test(navigator.userAgent),v=/OPR/i.test(navigator.userAgent),g=/Safari/i.test(navigator.userAgent),h=/Avast/i.test(navigator.userAgent),f=_&&!k,S=!1,w=!1,x=[],y=t.orientation!==undefined,C=!1,I=!1,A=!1;return{init:t=>{$.extend({module_name:'j1.adapter.speak2me',generated:'2025-09-27 03:33:52 +0200'},t);a=null!=t?$.extend({},t):{},s=$.extend({},{enabled:!1,dialogContainerID:"speak2me_container",speechSelector:"main",chrome_pause_resume_cycle:5e3,mobilesDisabled:!0,browsersDisabled:["Firefox","Opera","Avast","Safari"],modal:{title:"Text-2-Speech Control",settings:{voice_settings_title:"Voice Settings",voice_select_title:"Select a voice",voice_control_title:"Voice Control",speak_button_text:"Speak",speak_button_style:"success",stop_button_text:"Stop",stop_button_style:"danger",pause_button_text:"Pause",pause_button_style:"warning",resume_button_text:"Resume",resume_button_style:"info",exit_button_text:"Close",exit_button_style:"primary",voice_speed_min:.1,voice_speed_max:3,voice_speed_step:.1,voice_speed_value:1,voice_speed_label:"Speed",voice_speed_max_label:1,voice_pitch_min:.1,voice_pitch_max:2,voice_pitch_step:.1,voice_pitch_value:.9,voice_pitch_label:"Pitch",voice_pitch_max_label:.9,voice_volume_min:0,voice_volume_max:1,voice_volume_step:.1,voice_volume_value:.9,voice_volume_label:"Volume",voice_volume_max_label:.9}}}),o=$.extend({},{enabled:!0}),i=$.extend(!0,{},s,o,a),S="false"==i.tts,w="false"==i.mobilesDisabled,x=i.browsersDisabled,d=e.adapter.speak2me,l=log4javascript.getLogger('j1.adapter.speak2me'),d.setState('started'),l.debug('state: '+d.getState()),l.info('module is being initialized');var m=setInterval(()=>{var t='block'===$('#content').css("display");if('finished'===e.getState()&&t){if(u=Date.now(),d.setState('started'),l.debug('set module state to: '+d.getState()),l.info('initializing module: started'),w&&y)return console.log('module speak2me is disabled for mobile browsers'),l.warn('module speak2me is disabled for mobile browsers'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);if(!!x.includes('Opera')&&v)return console.log('module speak2me is disabled for the Opera browser'),l.warn('module speak2me is disabled for the Opera browser'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);if(!!x.includes('Firefox')&&b)return console.log('module speak2me is disabled for the Firefox browser'),l.warn('module speak2me is disabled for the Firefox browser'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);if(!!x.includes('Avast')&&h)return console.log('module speak2me is not supported for the Avast Secure browser'),l.warn('module speak2me is disabled for the Avast Secure browser'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);if(!!x.includes('Safari')&&!f&&!k&&!g)return console.log('module speak2me is disabled for the Safari browser'),l.warn('module speak2me is disabled for the Safari browser'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);if(S)return l.debug('tts detected: disabled'),$('#quickLinksSpeakButton').hide(),void clearInterval(m);(n=document.createElement('div')).id=i.dialogContainerID,n.style.display='none',n.setAttribute('class','modal fade'),n.setAttribute('tabindex','-1'),n.setAttribute('role','dialog'),n.setAttribute('aria-labelledby',i.dialogContainerID),document.body.append(n),l.info('load modal'),e.loadHTML({xhr_container_id:'speak2me_container',xhr_data_path:'/assets/data/speak2me/index.html',xhr_data_element:'speak2me-modal-data'},'j1.adapter.speak2me','null'),l.info('initialize modal'),$('#speak2me_container').on('show.bs.modal',function(){d.create('#voiceSelector')}),$('#speak2me_container').on('shown.bs.modal',function(){this.$buttonSpeak=$('#speak_button'),this.$buttonStop=$('#stop_button'),this.$buttonSpeak.click(function(){f&&(l.info('speak: setup pause workaround for chromium based browsers'),r=setInterval(()=>{var e=$().speak2me('isSpeaking');l.debug('speak: isSpeaking|isPaused: '+e+'|'+C),e?($().speak2me('pause').speak2me('resume'),l.debug('speak: send pause-resumed')):($().speak2me('resume'),l.debug('speak: send resumed'))},i.chrome_pause_resume_cycle))}),this.$buttonStop.click(function(){l.info('speak: remove pause workaround for chromium based browsers'),setTimeout(()=>{var e=$().speak2me('isSpeaking'),t=$().speak2me('isPaused');$('.mdib-speaker').removeClass('md-orange'),e||t||clearInterval(r)},3e3)})}),$('#speak2me_container').on('hidden.bs.modal',function(){}),d.setState('finished'),l.debug('state: '+d.getState()),l.info('module initialization finished'),p=Date.now(),l.info('module initializing time: '+(p-u)+'ms'),clearInterval(m)}},10)},create:e=>{1!=$('#voiceSelect').length&&0===$().speak2me('getVoices',e,'Select a voice')&&$(e).remove()},showDialog:()=>{l.debug("showDialog"),$('#speak2me_container').modal({backdrop:'static',keyboard:!1}),$('#speak2me_container').modal('show')},update:(e,t)=>{var a=parseFloat(t).toFixed(1);$(e).parent().find('span').text(a)},speak:e=>{var t,a=parseFloat(document.getElementById('rate').value),s=parseFloat(document.getElementById('pitch').value),o=parseFloat(document.getElementById('volume').value);$(e).speak2me('rate',a).speak2me('pitch',s).speak2me('volume',o),t=!!I;$(e).speak2me('speak',{isPaused:t,lastChunk:I,lastScrollPosition:A});$('.mdib-speaker').addClass('mdib-spin'),$('#stop_button').show(),$('#pause_button').show(),$('#speak_button').hide(),$('#resume_button').hide()},pause:()=>{$('.mdib-speaker').removeClass('mdib-spin'),$('.mdib-speaker').addClass('md-orange'),f?(I=$().speak2me('isSpoken'),A=$().speak2me('isScrolled'),$().speak2me('stop')):$().speak2me('pause'),$('#resume_button').show(),$('#pause_button').hide()},resume:()=>{$('.mdib-speaker').addClass('mdib-spin'),f?d.speak('main'):$().speak2me('resume'),$('#pause_button').show(),$('#resume_button').hide(),$('.mdib-speaker').removeClass('md-orange')},stop:()=>{$().speak2me('stop'),$('.mdib-speaker').removeClass('mdib-spin'),$('.mdib-speaker').removeClass('md-orange'),$('#speak_button').show(),location.reload()},messageHandler:(e,t)=>{var a=JSON.stringify(t,undefined,2);return m='received message from '+e+': '+a,l.debug(m),'command'===t.type&&'module_initialized'===t.action&&l.info(t.text),!0},setState:e=>{d.state=e},getState:()=>d.state}})(j1,window);